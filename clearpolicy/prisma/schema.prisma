datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Measure {
  id           String     @id @default(cuid())
  kind         String
  jurisdiction String
  session      String?
  number       String
  title        String
  status       String?
  slug         String     @unique
  sources      SourceDoc[]
  summaries    Summary[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model SourceDoc {
  id        String  @id @default(cuid())
  measureId String
  name      String
  url       String
  docType   String?
  Measure   Measure @relation(fields: [measureId], references: [id])
}

model Summary {
  id          String   @id @default(cuid())
  measureId   String
  level       String
  tldr        String
  whatItDoes  String
  whoAffected String
  pros        String
  cons        String
  sourceRatio Float
  citations   String
  Measure     Measure  @relation(fields: [measureId], references: [id])
}

model Feedback {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  page        String
  measureSlug String?
  message     String
  contact     String?
}

// UN/International Document Analysis Cache
// Stores analyses to avoid re-processing identical documents
model UnDocumentAnalysis {
  id               String   @id @default(cuid())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Document fingerprint (SHA-256 hash of normalized text)
  // Unique index for fast lookup
  documentHash     String   @unique
  
  // Source information
  sourceType       String   // "url" | "pdf" | "text"
  sourceReference  String?  // URL, filename, or short label
  
  // Document metadata
  title            String?
  documentLength   Int      // Original document length in chars
  
  // Full AI analysis result as JSON
  // Contains the complete UNDocumentAnalysis object
  analysisPayload  String   // JSON blob
  
  // Optional: for future per-user history
  userId           String?  // Prepared for auth, not required yet
  
  // Processing metadata
  processingTimeMs Int?
  modelUsed        String?
}
